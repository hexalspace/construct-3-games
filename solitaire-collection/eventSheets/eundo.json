{
	"name": "eUndo",
	"events": [
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "compare-size",
					"objectClass": "UndoArray",
					"sid": 967303895906615,
					"parameters": {
						"axis": "x",
						"comparison": 0,
						"value": "0"
					}
				},
				{
					"id": "compare-instance-variable",
					"objectClass": "TopBarButton",
					"sid": 282736449911986,
					"parameters": {
						"instance-variable": "Name",
						"comparison": 0,
						"value": "\"Undo\""
					}
				}
			],
			"actions": [
				{
					"id": "set-animation",
					"objectClass": "TopBarButton",
					"sid": 116086896191446,
					"parameters": {
						"animation": "\"Inactive\"",
						"from": "current-frame"
					}
				}
			],
			"sid": 757312960592671
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "else",
					"objectClass": "System",
					"sid": 919421609951220
				},
				{
					"id": "compare-instance-variable",
					"objectClass": "TopBarButton",
					"sid": 356290280597775,
					"parameters": {
						"instance-variable": "Name",
						"comparison": 0,
						"value": "\"Undo\""
					}
				}
			],
			"actions": [
				{
					"id": "set-animation",
					"objectClass": "TopBarButton",
					"sid": 504224401538117,
					"parameters": {
						"animation": "\"Active\"",
						"from": "current-frame"
					}
				}
			],
			"sid": 524919923979359
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "on-any-touch-end",
					"objectClass": "Touch",
					"sid": 774389830518389
				},
				{
					"id": "is-touching-object",
					"objectClass": "Touch",
					"sid": 847830608657324,
					"parameters": {
						"object": "TopBarButton"
					}
				},
				{
					"id": "compare-instance-variable",
					"objectClass": "TopBarButton",
					"sid": 458187214289888,
					"parameters": {
						"instance-variable": "Name",
						"comparison": 0,
						"value": "\"Undo\""
					}
				},
				{
					"id": "is-animation-playing",
					"objectClass": "TopBarButton",
					"sid": 597122839273580,
					"parameters": {
						"animation": "\"Active\""
					}
				}
			],
			"actions": [
				{
					"callFunction": "Undo",
					"sid": 227647027632775
				}
			],
			"sid": 572230848063015
		},
		{
			"functionName": "Undo",
			"functionDescription": "",
			"functionCategory": "",
			"functionReturnType": "none",
			"functionIsAsync": false,
			"functionParameters": [],
			"eventType": "function-block",
			"conditions": [],
			"actions": [],
			"sid": 955424412037964,
			"children": [
				{
					"eventType": "variable",
					"name": "NumberOfMovesToUndo",
					"type": "number",
					"initialValue": "1",
					"comment": "",
					"isStatic": false,
					"isConstant": false,
					"sid": 346826907957143
				},
				{
					"eventType": "variable",
					"name": "CheckingIndexOfUndoArray",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"isStatic": false,
					"isConstant": false,
					"sid": 182126824309567
				},
				{
					"eventType": "block",
					"conditions": [],
					"actions": [
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 584433420595203,
							"parameters": {
								"variable": "CheckingIndexOfUndoArray",
								"value": "UndoArray.Width - 1"
							}
						}
					],
					"sid": 501978853841282
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "while",
							"objectClass": "System",
							"sid": 185419647156991
						},
						{
							"id": "compare-at-xy",
							"objectClass": "UndoArray",
							"sid": 362096709363839,
							"parameters": {
								"x": "CheckingIndexOfUndoArray",
								"y": "3",
								"comparison": 0,
								"value": "1"
							}
						}
					],
					"actions": [
						{
							"id": "add-to-eventvar",
							"objectClass": "System",
							"sid": 839389779149544,
							"parameters": {
								"variable": "NumberOfMovesToUndo",
								"value": "1"
							}
						},
						{
							"id": "subtract-from-eventvar",
							"objectClass": "System",
							"sid": 519448097763415,
							"parameters": {
								"variable": "CheckingIndexOfUndoArray",
								"value": "1"
							}
						}
					],
					"sid": 255855356563574
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "repeat",
							"objectClass": "System",
							"sid": 334970953283007,
							"parameters": {
								"count": "NumberOfMovesToUndo"
							}
						}
					],
					"actions": [
						{
							"callFunction": "UndoMove",
							"sid": 999406517431600,
							"parameters": [
								"UndoArray.At(CheckingIndexOfUndoArray, 0)",
								"UndoArray.At(CheckingIndexOfUndoArray, 1)",
								"UndoArray.At(CheckingIndexOfUndoArray, 2)",
								"UndoArray.At(CheckingIndexOfUndoArray, 3)",
								"CheckingIndexOfUndoArray"
							]
						}
					],
					"sid": 999829221617759
				}
			]
		},
		{
			"functionName": "UndoMove",
			"functionDescription": "",
			"functionCategory": "",
			"functionReturnType": "none",
			"functionIsAsync": false,
			"functionParameters": [
				{
					"name": "CardUID",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"sid": 351903265818138
				},
				{
					"name": "FromType",
					"type": "string",
					"initialValue": "",
					"comment": "",
					"sid": 903778362252521
				},
				{
					"name": "FromUID",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"sid": 987326380478932
				},
				{
					"name": "Pinned",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"sid": 943883155849349
				},
				{
					"name": "IndexInUndoArray",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"sid": 173750517298321
				}
			],
			"eventType": "function-block",
			"conditions": [],
			"actions": [
				{
					"type": "comment",
					"text": "can recurse"
				}
			],
			"sid": 293547819675673,
			"children": [
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-eventvar",
							"objectClass": "System",
							"sid": 328559878739208,
							"parameters": {
								"variable": "FromType",
								"comparison": 1,
								"value": "\"FlipCard\""
							}
						},
						{
							"id": "compare-eventvar",
							"objectClass": "System",
							"sid": 156703413786887,
							"parameters": {
								"variable": "CardUID",
								"comparison": 4,
								"value": "-1"
							}
						}
					],
					"actions": [
						{
							"callFunction": "ReturnCardToLastPosition",
							"sid": 860462677532888,
							"parameters": [
								"CardUID",
								"FromType",
								"FromUID",
								false
							]
						}
					],
					"sid": 480760542446971
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-eventvar",
							"objectClass": "System",
							"sid": 560162807481236,
							"parameters": {
								"variable": "FromType",
								"comparison": 0,
								"value": "\"StockFlip\""
							}
						},
						{
							"id": "pick-by-unique-id",
							"objectClass": "Stock",
							"sid": 461671909668474,
							"parameters": {
								"unique-id": "FromUID"
							}
						}
					],
					"actions": [
						{
							"id": "add-to-instvar",
							"objectClass": "Stock",
							"sid": 548533662582841,
							"parameters": {
								"instance-variable": "FlipsRemaining",
								"value": "1"
							}
						}
					],
					"sid": 574683466596464,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "pick-all",
									"objectClass": "System",
									"sid": 934830210528998,
									"parameters": {
										"object": "Card"
									}
								},
								{
									"id": "is-overlapping-another-object",
									"objectClass": "Card",
									"sid": 961303337949275,
									"parameters": {
										"object": "Stock"
									}
								},
								{
									"id": "for-each-ordered",
									"objectClass": "System",
									"sid": 679173676550018,
									"parameters": {
										"object": "Card",
										"expression": "Card.ZIndex",
										"order": "descending"
									}
								}
							],
							"actions": [
								{
									"id": "set-position",
									"objectClass": "Card",
									"sid": 899562076478319,
									"parameters": {
										"x": "Discard.X",
										"y": "Discard.Y"
									}
								},
								{
									"id": "move-to-top",
									"objectClass": "Card",
									"sid": 896946251037956
								},
								{
									"id": "set-animation",
									"objectClass": "Card",
									"sid": 388905114793008,
									"parameters": {
										"animation": "DECK_ART",
										"from": "beginning"
									}
								},
								{
									"id": "set-animation-frame",
									"objectClass": "Card",
									"sid": 618504381866250,
									"parameters": {
										"frame-number": "Card.Frame"
									}
								},
								{
									"id": "set-enabled",
									"objectClass": "Card",
									"sid": 228168415555680,
									"behaviorType": "DragDrop",
									"parameters": {
										"state": "enabled"
									}
								}
							],
							"sid": 542305859689177
						}
					]
				},
				{
					"eventType": "block",
					"conditions": [],
					"actions": [
						{
							"id": "delete",
							"objectClass": "UndoArray",
							"sid": 743592390533913,
							"parameters": {
								"index": "IndexInUndoArray",
								"axis": "x"
							}
						}
					],
					"sid": 657687260267705
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-eventvar",
							"objectClass": "System",
							"sid": 165899714692134,
							"parameters": {
								"variable": "FromType",
								"comparison": 0,
								"value": "\"FlipCard\""
							}
						}
					],
					"actions": [],
					"sid": 484568300568754,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "pick-by-unique-id",
									"objectClass": "Card",
									"sid": 579320408143616,
									"parameters": {
										"unique-id": "CardUID"
									}
								}
							],
							"actions": [
								{
									"id": "set-animation",
									"objectClass": "Card",
									"sid": 633844678028829,
									"parameters": {
										"animation": "DECK_ART & \"Backs\"",
										"from": "beginning"
									}
								},
								{
									"id": "set-boolean-instvar",
									"objectClass": "Card",
									"sid": 631371983733529,
									"parameters": {
										"instance-variable": "IsMovable",
										"value": "false"
									}
								},
								{
									"id": "set-enabled",
									"objectClass": "Card",
									"sid": 198224876369310,
									"behaviorType": "DragDrop",
									"parameters": {
										"state": "disabled"
									}
								}
							],
							"sid": 841512812506591
						},
						{
							"eventType": "block",
							"conditions": [],
							"actions": [
								{
									"type": "comment",
									"text": "so far, we have only flipped the card. recurse to actually move a card on top of the flipped card"
								},
								{
									"callFunction": "Undo",
									"sid": 605720290669703
								}
							],
							"sid": 151653555136377
						}
					]
				}
			]
		},
		{
			"functionName": "PushToUndoArray",
			"functionDescription": "",
			"functionCategory": "",
			"functionReturnType": "none",
			"functionIsAsync": false,
			"functionParameters": [
				{
					"name": "CardUID",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"sid": 862626677932731
				},
				{
					"name": "FromType",
					"type": "string",
					"initialValue": "",
					"comment": "",
					"sid": 986618021985952
				},
				{
					"name": "FromUID",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"sid": 618784523508909
				},
				{
					"name": "Pinned",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"sid": 713803634484874
				}
			],
			"eventType": "function-block",
			"conditions": [],
			"actions": [
				{
					"type": "comment",
					"text": "pinned: part (but not the first card) of a multi-card move"
				},
				{
					"id": "push",
					"objectClass": "UndoArray",
					"sid": 536093857210066,
					"parameters": {
						"where": "back",
						"value": "CardUID",
						"axis": "x"
					}
				},
				{
					"id": "set-at-xy",
					"objectClass": "UndoArray",
					"sid": 714822212197016,
					"parameters": {
						"x": "UndoArray.Width - 1",
						"y": "1",
						"value": "FromType"
					}
				},
				{
					"id": "set-at-xy",
					"objectClass": "UndoArray",
					"sid": 806374374806442,
					"parameters": {
						"x": "UndoArray.Width - 1",
						"y": "2",
						"value": "FromUID"
					}
				},
				{
					"id": "set-at-xy",
					"objectClass": "UndoArray",
					"sid": 213962144936782,
					"parameters": {
						"x": "UndoArray.Width - 1",
						"y": "3",
						"value": "Pinned"
					}
				}
			],
			"sid": 474556955649895,
			"children": [
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-eventvar",
							"objectClass": "System",
							"sid": 547513750902363,
							"parameters": {
								"variable": "FromType",
								"comparison": 0,
								"value": "\"Foundation\""
							}
						}
					],
					"actions": [
						{
							"callFunction": "MoveCardFromFoundation",
							"sid": 118018180660719,
							"parameters": [
								"CardUID",
								"FromUID"
							]
						}
					],
					"sid": 770827305267040
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-eventvar",
							"objectClass": "System",
							"sid": 552787116957290,
							"parameters": {
								"variable": "FromType",
								"comparison": 0,
								"value": "\"Tableau\""
							}
						}
					],
					"actions": [
						{
							"callFunction": "MoveCardFromTableau",
							"sid": 449739646669453,
							"parameters": [
								"CardUID",
								"FromUID"
							]
						}
					],
					"sid": 444342415695872
				}
			]
		},
		{
			"functionName": "ReturnCardToLastPosition",
			"functionDescription": "",
			"functionCategory": "",
			"functionReturnType": "none",
			"functionIsAsync": false,
			"functionParameters": [
				{
					"name": "CardUID",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"sid": 371815288763754
				},
				{
					"name": "FromType",
					"type": "string",
					"initialValue": "",
					"comment": "",
					"sid": 772989341188485
				},
				{
					"name": "FromUID",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"sid": 395798620912525
				},
				{
					"name": "IsCancelingMove",
					"type": "boolean",
					"initialValue": "false",
					"comment": "",
					"sid": 418025627580096
				}
			],
			"eventType": "function-block",
			"conditions": [
				{
					"id": "pick-by-unique-id",
					"objectClass": "Card",
					"sid": 210379781808546,
					"parameters": {
						"unique-id": "CardUID"
					}
				}
			],
			"actions": [],
			"sid": 197237194085310,
			"children": [
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-boolean-eventvar",
							"objectClass": "System",
							"sid": 246268268656601,
							"parameters": {
								"variable": "IsCancelingMove"
							},
							"isInverted": true
						}
					],
					"actions": [],
					"sid": 199745202229120,
					"children": [
						{
							"eventType": "comment",
							"text": "returning from"
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "is-overlapping-another-object",
									"objectClass": "Card",
									"sid": 499002418962808,
									"parameters": {
										"object": "Discard"
									}
								}
							],
							"actions": [],
							"sid": 641858431677693
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "is-overlapping-another-object",
									"objectClass": "Card",
									"sid": 993273607935152,
									"parameters": {
										"object": "Foundation"
									}
								}
							],
							"actions": [
								{
									"callFunction": "MoveCardFromFoundation",
									"sid": 568075771905816,
									"parameters": [
										"Card.UID",
										"Foundation.UID"
									]
								}
							],
							"sid": 494073708532024
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "is-overlapping-another-object",
									"objectClass": "Card",
									"sid": 506842773901242,
									"parameters": {
										"object": "Stock"
									}
								}
							],
							"actions": [],
							"sid": 117608401181811
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "is-overlapping-another-object",
									"objectClass": "Card",
									"sid": 495957988944269,
									"parameters": {
										"object": "Tableau"
									}
								}
							],
							"actions": [
								{
									"callFunction": "MoveCardFromTableau",
									"sid": 599160136599031,
									"parameters": [
										"Card.UID",
										"Tableau.UID"
									]
								},
								{
									"id": "subtract-from-instvar",
									"objectClass": "Tableau",
									"sid": 992629280991174,
									"parameters": {
										"instance-variable": "NumberOfCards",
										"value": "1"
									}
								},
								{
									"callFunction": "SetTableauHeight",
									"sid": 656941638328807,
									"parameters": [
										"Tableau.UID"
									]
								}
							],
							"sid": 466037712005926
						}
					]
				},
				{
					"eventType": "comment",
					"text": "returning to"
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-eventvar",
							"objectClass": "System",
							"sid": 259464984773321,
							"parameters": {
								"variable": "FromType",
								"comparison": 0,
								"value": "\"Discard\""
							}
						},
						{
							"id": "pick-by-unique-id",
							"objectClass": "Discard",
							"sid": 355677224574447,
							"parameters": {
								"unique-id": "FromUID"
							}
						}
					],
					"actions": [
						{
							"id": "set-position",
							"objectClass": "Card",
							"sid": 846049557993667,
							"parameters": {
								"x": "Discard.X",
								"y": "Discard.Y"
							}
						}
					],
					"sid": 488807605715800
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-eventvar",
							"objectClass": "System",
							"sid": 263682881176619,
							"parameters": {
								"variable": "FromType",
								"comparison": 0,
								"value": "\"Foundation\""
							}
						},
						{
							"id": "pick-by-unique-id",
							"objectClass": "Foundation",
							"sid": 172659255957784,
							"parameters": {
								"unique-id": "FromUID"
							}
						}
					],
					"actions": [],
					"sid": 801272649245621,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-boolean-eventvar",
									"objectClass": "System",
									"sid": 984253354688911,
									"parameters": {
										"variable": "IsCancelingMove"
									}
								}
							],
							"actions": [
								{
									"callFunction": "MoveCardToFoundation",
									"sid": 622350475042523,
									"parameters": [
										"Card.UID",
										"Foundation.UID",
										true
									]
								}
							],
							"sid": 491767326950791
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 974201920689334
								}
							],
							"actions": [
								{
									"callFunction": "MoveCardToFoundation",
									"sid": 543459224559019,
									"parameters": [
										"Card.UID",
										"Foundation.UID",
										false
									]
								}
							],
							"sid": 625932620633000
						}
					]
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-eventvar",
							"objectClass": "System",
							"sid": 569958637077620,
							"parameters": {
								"variable": "FromType",
								"comparison": 0,
								"value": "\"Stock\""
							}
						},
						{
							"id": "pick-by-unique-id",
							"objectClass": "Stock",
							"sid": 881348620357661,
							"parameters": {
								"unique-id": "FromUID"
							}
						}
					],
					"actions": [
						{
							"id": "move-to-top",
							"objectClass": "Card",
							"sid": 421613627739482
						},
						{
							"id": "set-enabled",
							"objectClass": "Card",
							"sid": 580494562364310,
							"behaviorType": "DragDrop",
							"parameters": {
								"state": "disabled"
							}
						},
						{
							"id": "tween-two-properties",
							"objectClass": "Card",
							"sid": 645374588090586,
							"behaviorType": "Tween",
							"parameters": {
								"tags": "\"\"",
								"property": "position",
								"end-x": "Stock.X",
								"end-y": "Stock.Y",
								"time": "STOCK_FLIP_TWEEN_TIME",
								"ease": "default",
								"destroy-on-complete": "no",
								"loop": "no",
								"ping-pong": "no"
							}
						},
						{
							"id": "tween-one-property",
							"objectClass": "Card",
							"sid": 687024194900809,
							"behaviorType": "Tween",
							"parameters": {
								"tags": "\"FlipCardTweenWidth\"",
								"property": "offsetWidth",
								"end-value": "0",
								"time": "STOCK_FLIP_TWEEN_TIME / 2",
								"ease": "default",
								"destroy-on-complete": "no",
								"loop": "no",
								"ping-pong": "yes"
							}
						},
						{
							"id": "wait",
							"objectClass": "System",
							"sid": 368661395184568,
							"parameters": {
								"seconds": "STOCK_FLIP_TWEEN_TIME / 2"
							}
						},
						{
							"id": "set-animation",
							"objectClass": "Card",
							"sid": 604401882740452,
							"parameters": {
								"animation": "DECK_ART & \"Backs\"",
								"from": "beginning"
							}
						}
					],
					"sid": 484892980046984
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-eventvar",
							"objectClass": "System",
							"sid": 415016535441559,
							"parameters": {
								"variable": "FromType",
								"comparison": 0,
								"value": "\"Tableau\""
							}
						},
						{
							"id": "pick-by-unique-id",
							"objectClass": "Tableau",
							"sid": 465003135520723,
							"parameters": {
								"unique-id": "FromUID"
							}
						}
					],
					"actions": [],
					"sid": 649487091183266,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-boolean-eventvar",
									"objectClass": "System",
									"sid": 505945715976171,
									"parameters": {
										"variable": "IsCancelingMove"
									}
								}
							],
							"actions": [
								{
									"callFunction": "MoveCardToTableau",
									"sid": 306758218746588,
									"parameters": [
										"Card.UID",
										"Tableau.UID"
									]
								}
							],
							"sid": 138005359963806
						},
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "else",
									"objectClass": "System",
									"sid": 442314060359272
								}
							],
							"actions": [
								{
									"callFunction": "MoveCardToTableau",
									"sid": 427282543166415,
									"parameters": [
										"Card.UID",
										"Tableau.UID"
									]
								}
							],
							"sid": 208071433096969
						}
					]
				}
			]
		}
	],
	"sid": 556817675701426
}