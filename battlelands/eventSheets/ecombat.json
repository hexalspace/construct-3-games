{
	"name": "eCombat",
	"events": [
		{
			"eventType": "variable",
			"name": "IsPlayerTurn",
			"type": "boolean",
			"initialValue": "true",
			"comment": "",
			"isStatic": false,
			"isConstant": false,
			"sid": 915269375265163
		},
		{
			"eventType": "variable",
			"name": "NumberOfEnemyAbilities",
			"type": "number",
			"initialValue": "0",
			"comment": "",
			"isStatic": false,
			"isConstant": false,
			"sid": 139193172589343
		},
		{
			"eventType": "variable",
			"name": "PlayerMaxHP",
			"type": "number",
			"initialValue": "30",
			"comment": "",
			"isStatic": false,
			"isConstant": false,
			"sid": 236734481628179
		},
		{
			"eventType": "include",
			"includeSheet": "eCursor"
		},
		{
			"eventType": "include",
			"includeSheet": "ePrepForCombat"
		},
		{
			"eventType": "block",
			"conditions": [
				{
					"id": "on-nth-touch-end",
					"objectClass": "Touch",
					"sid": 989295156157393,
					"parameters": {
						"touch-number": "0"
					}
				},
				{
					"id": "compare-boolean-eventvar",
					"objectClass": "System",
					"sid": 795640469429975,
					"parameters": {
						"variable": "IsPlayerTurn"
					}
				},
				{
					"id": "is-touching-object",
					"objectClass": "Touch",
					"sid": 377300971435442,
					"parameters": {
						"object": "AbilityButton"
					}
				},
				{
					"id": "is-animation-playing",
					"objectClass": "AbilityButton",
					"sid": 756866748475381,
					"parameters": {
						"animation": "\"Full\""
					}
				}
			],
			"actions": [
				{
					"callFunction": "UseAbility",
					"sid": 187920739872799,
					"parameters": [
						"Functions.GetAbilityBeingUsed(AbilityButton.Slot)",
						"\"Player\""
					]
				}
			],
			"sid": 121693036853967
		},
		{
			"functionName": "UseAbility",
			"functionDescription": "",
			"functionCategory": "",
			"functionReturnType": "none",
			"functionIsAsync": false,
			"functionParameters": [
				{
					"name": "AbilityName",
					"type": "string",
					"initialValue": "",
					"comment": "",
					"sid": 177971052130510
				},
				{
					"name": "Caster",
					"type": "string",
					"initialValue": "",
					"comment": "",
					"sid": 150667746012859
				}
			],
			"eventType": "function-block",
			"conditions": [],
			"actions": [],
			"sid": 505024504528205,
			"children": [
				{
					"eventType": "variable",
					"name": "IsBasicAttack",
					"type": "boolean",
					"initialValue": "false",
					"comment": "",
					"isStatic": false,
					"isConstant": false,
					"sid": 117540557075692
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-boolean-eventvar",
							"objectClass": "System",
							"sid": 992817203117398,
							"parameters": {
								"variable": "IsPlayerTurn"
							}
						}
					],
					"actions": [
						{
							"callFunction": "BlockPlayerCasting",
							"sid": 435025167971787
						}
					],
					"sid": 431182316619816
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "else",
							"objectClass": "System",
							"sid": 860833745285222
						}
					],
					"actions": [
						{
							"callFunction": "AllowPlayerCasting",
							"sid": 721841713921823
						}
					],
					"sid": 299219104538996
				},
				{
					"eventType": "block",
					"conditions": [],
					"actions": [
						{
							"callFunction": "BasicAttack",
							"sid": 282465542736451,
							"parameters": [
								"AbilityName",
								"Caster",
								"JSON.Get(\"abilities.\" & AbilityName & \".damageRoll\")"
							]
						}
					],
					"sid": 418975993389134
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-boolean-eventvar",
							"objectClass": "System",
							"sid": 844673150008878,
							"parameters": {
								"variable": "IsPlayerTurn"
							},
							"isInverted": true
						}
					],
					"actions": [
						{
							"callFunction": "EndPlayerTurn",
							"sid": 884669954501331
						}
					],
					"sid": 212124626237434
				}
			]
		},
		{
			"functionName": "BasicAttack",
			"functionDescription": "",
			"functionCategory": "",
			"functionReturnType": "none",
			"functionIsAsync": false,
			"functionParameters": [
				{
					"name": "AttackName",
					"type": "string",
					"initialValue": "",
					"comment": "",
					"sid": 189419425479864
				},
				{
					"name": "Caster",
					"type": "string",
					"initialValue": "",
					"comment": "",
					"sid": 543889386247083
				},
				{
					"name": "DamageRoll",
					"type": "string",
					"initialValue": "",
					"comment": "",
					"sid": 645420139882324
				}
			],
			"eventType": "function-block",
			"conditions": [],
			"actions": [],
			"sid": 638469786085642,
			"children": [
				{
					"eventType": "variable",
					"name": "CharacterTakingDamage",
					"type": "string",
					"initialValue": "",
					"comment": "",
					"isStatic": false,
					"isConstant": false,
					"sid": 639246437848545
				},
				{
					"eventType": "variable",
					"name": "Damage",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"isStatic": false,
					"isConstant": false,
					"sid": 124277059018778
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-eventvar",
							"objectClass": "System",
							"sid": 151423032203943,
							"parameters": {
								"variable": "Caster",
								"comparison": 0,
								"value": "\"Player\""
							}
						}
					],
					"actions": [
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 747991743316822,
							"parameters": {
								"variable": "CharacterTakingDamage",
								"value": "\"Enemy\""
							}
						}
					],
					"sid": 753201922630949
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "else",
							"objectClass": "System",
							"sid": 424458251773411
						}
					],
					"actions": [
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 320270703610905,
							"parameters": {
								"variable": "CharacterTakingDamage",
								"value": "\"Player\""
							}
						}
					],
					"sid": 445902764969491
				},
				{
					"eventType": "block",
					"conditions": [],
					"actions": [
						{
							"id": "set-eventvar-value",
							"objectClass": "System",
							"sid": 431192535619493,
							"parameters": {
								"variable": "Damage",
								"value": "Functions.ParseDice(Ability.DamageRoll)"
							}
						}
					],
					"sid": 213878302360613
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-eventvar",
							"objectClass": "System",
							"sid": 240117541699222,
							"parameters": {
								"variable": "Caster",
								"comparison": 0,
								"value": "\"Player\""
							}
						},
						{
							"id": "compare-instance-variable",
							"objectClass": "Text",
							"sid": 530989381958940,
							"parameters": {
								"instance-variable": "Name",
								"comparison": 0,
								"value": "\"Combat Log\""
							}
						}
					],
					"actions": [
						{
							"id": "append-text",
							"objectClass": "Text",
							"sid": 328212279499192,
							"parameters": {
								"text": "Functions.ReplaceCombatLogVariables(Player.Name, JSON.Get(\"abilities.\" & AttackName & \".combatLogProc\"), Damage, Enemy.Name) & newline"
							}
						}
					],
					"sid": 557497428511977
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "else",
							"objectClass": "System",
							"sid": 760598115113732
						},
						{
							"id": "compare-instance-variable",
							"objectClass": "Text",
							"sid": 351180654404073,
							"parameters": {
								"instance-variable": "Name",
								"comparison": 0,
								"value": "\"Combat Log\""
							}
						}
					],
					"actions": [
						{
							"id": "append-text",
							"objectClass": "Text",
							"sid": 817522365408553,
							"parameters": {
								"text": "Functions.ReplaceCombatLogVariables(Enemy.Name, JSON.Get(\"abilities.\" & AttackName & \".combatLogProc\"), Damage, Player.Name) & newline"
							}
						}
					],
					"sid": 311188751874758
				},
				{
					"eventType": "block",
					"conditions": [],
					"actions": [
						{
							"callFunction": "TakeDamage",
							"sid": 983660610226632,
							"parameters": [
								"CharacterTakingDamage",
								"Damage"
							]
						}
					],
					"sid": 255257837991738
				}
			]
		},
		{
			"functionName": "TakeDamage",
			"functionDescription": "",
			"functionCategory": "",
			"functionReturnType": "none",
			"functionIsAsync": false,
			"functionParameters": [
				{
					"name": "Character",
					"type": "string",
					"initialValue": "",
					"comment": "",
					"sid": 709029003585657
				},
				{
					"name": "Damage",
					"type": "number",
					"initialValue": "0",
					"comment": "",
					"sid": 833276158252624
				}
			],
			"eventType": "function-block",
			"conditions": [],
			"actions": [],
			"sid": 310753636017706,
			"children": [
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-eventvar",
							"objectClass": "System",
							"sid": 923895575125301,
							"parameters": {
								"variable": "Character",
								"comparison": 0,
								"value": "\"Player\""
							}
						}
					],
					"actions": [
						{
							"id": "set-instvar-value",
							"objectClass": "Player",
							"sid": 654533775219930,
							"parameters": {
								"instance-variable": "CurrentHP",
								"value": "max(0, Player.CurrentHP - Damage)"
							}
						},
						{
							"callFunction": "SetPlayerHPText",
							"sid": 263295434213226
						}
					],
					"sid": 595618893551063,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-two-values",
									"objectClass": "System",
									"sid": 876333774019212,
									"parameters": {
										"first-value": "Player.CurrentHP",
										"comparison": 3,
										"second-value": "0"
									}
								}
							],
							"actions": [
								{
									"callFunction": "PlayerDies",
									"sid": 300789588670671
								}
							],
							"sid": 973397490765494
						}
					]
				},
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-eventvar",
							"objectClass": "System",
							"sid": 407154079398723,
							"parameters": {
								"variable": "Character",
								"comparison": 0,
								"value": "\"Enemy\""
							}
						}
					],
					"actions": [
						{
							"id": "set-instvar-value",
							"objectClass": "Enemy",
							"sid": 322599751624221,
							"parameters": {
								"instance-variable": "CurrentHP",
								"value": "max(0, Enemy.CurrentHP - Damage)"
							}
						},
						{
							"callFunction": "SetEnemyHPText",
							"sid": 967507585850578
						}
					],
					"sid": 628157594835834,
					"children": [
						{
							"eventType": "block",
							"conditions": [
								{
									"id": "compare-two-values",
									"objectClass": "System",
									"sid": 788155578569189,
									"parameters": {
										"first-value": "Enemy.CurrentHP",
										"comparison": 3,
										"second-value": "0"
									}
								}
							],
							"actions": [
								{
									"callFunction": "EnemyDies",
									"sid": 597444235288387
								}
							],
							"sid": 281106736026725
						}
					]
				}
			]
		},
		{
			"functionName": "AllowPlayerCasting",
			"functionDescription": "",
			"functionCategory": "",
			"functionReturnType": "none",
			"functionIsAsync": false,
			"functionParameters": [],
			"eventType": "function-block",
			"conditions": [],
			"actions": [
				{
					"id": "set-boolean-eventvar",
					"objectClass": "System",
					"sid": 547171857233670,
					"parameters": {
						"variable": "IsPlayerTurn",
						"value": "true"
					}
				},
				{
					"id": "set-opacity",
					"objectClass": "AbilityButton",
					"sid": 273013236228053,
					"parameters": {
						"opacity": "100"
					}
				},
				{
					"id": "set-opacity",
					"objectClass": "Ability",
					"sid": 398219846068796,
					"parameters": {
						"opacity": "100"
					}
				}
			],
			"sid": 345878766042527
		},
		{
			"functionName": "BlockPlayerCasting",
			"functionDescription": "",
			"functionCategory": "",
			"functionReturnType": "none",
			"functionIsAsync": false,
			"functionParameters": [],
			"eventType": "function-block",
			"conditions": [],
			"actions": [
				{
					"id": "set-boolean-eventvar",
					"objectClass": "System",
					"sid": 962697040539402,
					"parameters": {
						"variable": "IsPlayerTurn",
						"value": "false"
					}
				},
				{
					"id": "set-opacity",
					"objectClass": "AbilityButton",
					"sid": 234039509065494,
					"parameters": {
						"opacity": "30"
					}
				},
				{
					"id": "set-opacity",
					"objectClass": "Ability",
					"sid": 340904728727530,
					"parameters": {
						"opacity": "30"
					}
				}
			],
			"sid": 675271122384392
		},
		{
			"functionName": "EndPlayerTurn",
			"functionDescription": "",
			"functionCategory": "",
			"functionReturnType": "none",
			"functionIsAsync": false,
			"functionParameters": [],
			"eventType": "function-block",
			"conditions": [],
			"actions": [],
			"sid": 176986080249516,
			"children": [
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-instance-variable",
							"objectClass": "Enemy",
							"sid": 984426148598400,
							"parameters": {
								"instance-variable": "CurrentHP",
								"comparison": 4,
								"value": "0"
							}
						},
						{
							"id": "compare-instance-variable",
							"objectClass": "Player",
							"sid": 550287863274908,
							"parameters": {
								"instance-variable": "CurrentHP",
								"comparison": 4,
								"value": "0"
							}
						}
					],
					"actions": [
						{
							"callFunction": "TakeEnemyTurn",
							"sid": 808275995886139
						}
					],
					"sid": 652712357910562
				}
			]
		},
		{
			"functionName": "TakeEnemyTurn",
			"functionDescription": "",
			"functionCategory": "",
			"functionReturnType": "none",
			"functionIsAsync": false,
			"functionParameters": [],
			"eventType": "function-block",
			"conditions": [],
			"actions": [
				{
					"id": "wait",
					"objectClass": "System",
					"sid": 198748695884025,
					"parameters": {
						"seconds": "1"
					}
				},
				{
					"id": "wait-for-previous-actions",
					"objectClass": "System",
					"sid": 201588118623337
				},
				{
					"type": "comment",
					"text": "TODO: use random ability from NumberOfEnemyAbilities"
				},
				{
					"callFunction": "UseAbility",
					"sid": 822973693222747,
					"parameters": [
						"Enemy.Ability1",
						"\"Enemy\""
					]
				}
			],
			"sid": 687586611543011
		},
		{
			"functionName": "PlayerDies",
			"functionDescription": "",
			"functionCategory": "",
			"functionReturnType": "none",
			"functionIsAsync": false,
			"functionParameters": [],
			"eventType": "function-block",
			"conditions": [],
			"actions": [
				{
					"id": "set-boolean-eventvar",
					"objectClass": "System",
					"sid": 749266299095172,
					"parameters": {
						"variable": "IsPlayerTurn",
						"value": "false"
					}
				}
			],
			"sid": 700352390303312,
			"children": [
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-instance-variable",
							"objectClass": "Text",
							"sid": 782057841681594,
							"parameters": {
								"instance-variable": "Name",
								"comparison": 0,
								"value": "\"Combat Log\""
							}
						}
					],
					"actions": [
						{
							"id": "append-text",
							"objectClass": "Text",
							"sid": 281957310477487,
							"parameters": {
								"text": "\"You were defeated by the \" & Enemy.Name & \".\" & newline"
							}
						}
					],
					"sid": 569398171274606
				}
			]
		},
		{
			"functionName": "EnemyDies",
			"functionDescription": "",
			"functionCategory": "",
			"functionReturnType": "none",
			"functionIsAsync": false,
			"functionParameters": [],
			"eventType": "function-block",
			"conditions": [],
			"actions": [
				{
					"id": "set-boolean-eventvar",
					"objectClass": "System",
					"sid": 613058515046296,
					"parameters": {
						"variable": "IsPlayerTurn",
						"value": "false"
					}
				}
			],
			"sid": 665859488933097,
			"children": [
				{
					"eventType": "block",
					"conditions": [
						{
							"id": "compare-instance-variable",
							"objectClass": "Text",
							"sid": 153310594514998,
							"parameters": {
								"instance-variable": "Name",
								"comparison": 0,
								"value": "\"Combat Log\""
							}
						}
					],
					"actions": [
						{
							"id": "append-text",
							"objectClass": "Text",
							"sid": 640899064737063,
							"parameters": {
								"text": "\"You defeated the \" & Enemy.Name & \"!\" & newline"
							}
						},
						{
							"id": "delete",
							"objectClass": "EnemiesArray",
							"sid": 871516108870880,
							"parameters": {
								"index": "FocusedEnemyArrayIndex",
								"axis": "x"
							}
						},
						{
							"id": "wait",
							"objectClass": "System",
							"sid": 817493977357510,
							"parameters": {
								"seconds": "5"
							}
						},
						{
							"id": "go-to-layout",
							"objectClass": "System",
							"sid": 404143089664637,
							"parameters": {
								"layout": "Overworld"
							}
						}
					],
					"sid": 988492818688334
				}
			]
		}
	],
	"sid": 772248937910943
}